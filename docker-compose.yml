version: "3"  
services: 
  jenkins:  
    container_name: dev-jenkins
    image: jenkins/jenkins:lts 
    restart: always
    privileged: true
    volumes:  
      - /var/jenkins_home/:/var/jenkins_home
      - /usr/local/jdk1.8.0_45/:/usr/local/jdk
      - /usr/local/sonar-scanner-3.1.0.1141:/usr/local/sonar-scanner-3.1.0.1141     
      - /usr/local/apache-maven-3.5.0:/usr/local/apache-maven-3.5.0
      - /var/run/docker.sock:/var/run/docker.sock 
      - /usr/bin/docker:/usr/bin/docker
      - /usr/local/bin/docker-compose:/usr/local/bin/docker-compose
      -  ~/.ssh:/root/.ssh
    environment:
      TZ: ${GLOBAL_TIME_ZONE}
      JAVA_OPTS: "-Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Seoul"
    ports:
      - "80:8080"
      
  sonarqube:
    container_name: sonarqube
    image: sonarqube
    ports:
      - "9000:9000
    environment:
      - SONARQUBE_JDBC_URL=jdbc:postgresql://db:5432/sonar
    volumes:
      - /opt/sonarqube/extensions
      - /opt/sonarqube/lib/bundled-plugins
    command: /bin/true
  
    
    
#   db:
#     image: postgres
#     container_name: postgres
#     networks:
#       - sonarnet
#     environment:
#       - POSTGRES_USER=${SONARQUBE_JDBC_USERNAME}
#       - POSTGRES_PASSWORD=${SONARQUBE_JDBC_PASSWORD}
#     volumes:
#       - /app/sonarqube/postgres:/home/deploy/docker-jenkins-sonarqube-1/db/postgres/data
     
#   sonarqube:
#     image: sonarqube:7.9.1-community
#     container_name: dev-sonarqube
#     ports:
#       - "8080:9000"
#       - "9092:9092"
#     networks:
#       - sonarnet
#     environment:
#       - SONARQUBE_HOME=/opt/sonarqube
#       - SONARQUBE_JDBC_USERNAME=${SONARQUBE_JDBC_USERNAME}
#       - SONARQUBE_JDBC_PASSWORD=${SONARQUBE_JDBC_PASSWORD}
#       - SONARQUBE_JDBC_URL=jdbc:postgresql://db:5432/sonar
#     volumes:
#       - /app/sonarqube/conf:/home/deploy/docker-jenkins-sonarqube-1/sonarqube/conf
#       - /app/sonarqube/data:/home/deploy/docker-jenkins-sonarqube-1/sonarqube/data
#       - /app/sonarqube/logs:/home/deploy/docker-jenkins-sonarqube-1/sonarqube/logs
#       - /app/sonarqube/extensions:/home/deploy/docker-jenkins-sonarqube-1/sonarqube/extensions
 
  
# networks:
#   sonarnet:
#     driver: bridge
